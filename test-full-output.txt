
> espaco-dialogico@1.0.0 test
> npm run services:up && npm run services:wait:database && npm run db:ensure:test && cross-env NODE_ENV=test JEST_EXPLICIT_RUN=true concurrently -k -s first "next dev" "wait-on -t 30000 -i 1000 -v http://localhost:3000/api/v1/status && jest --runInBand --verbose --forceExit"


> espaco-dialogico@1.0.0 services:up
> docker compose -f infra/compose.yaml up -d

 Container espaco_dialogico  Running

> espaco-dialogico@1.0.0 services:wait:database
> node infra/scripts/wait-for-postgres.js



Â­Æ’Ã¶Ã¤ Esperando PostgreSQL ficar disponâ”œÂ¡vel...

Ã”Â£Ã  PostgreSQL estâ”œÃ­ pronto e operacional!


> espaco-dialogico@1.0.0 db:ensure:test
> node infra/scripts/ensure-test-db.js .env.test

Â­Æ’Ã¶Âº Carregado arquivo de ambiente: .env.test
Â­Æ’Ã¶Ã¹ (Tentativa 1/20) Conectando (host=localhost port=5434 user=local_user)...
Ã”Â£Ã  Conexâ”œÃºo administrativa estabelecida.
Ã”Â£Ã  Banco de teste 'local_db_test' jâ”œÃ­ existe.
[1] waiting for 1 resources: http://localhost:3000/api/v1/status
[1] making HTTP(S) head request to  url:http://localhost:3000/api/v1/status ...
[1]   HTTP(S) error for http://localhost:3000/api/v1/status AggregateError: Error
[0]    Ã”Ã»â–“ Next.js 15.4.10
[0]    - Local:        http://localhost:3000
[0]    - Network:      http://192.168.0.44:3000
[0]    - Environments: .env.test
[0] 
[0]  Ã”Â£Ã´ Starting...
[1] making HTTP(S) head request to  url:http://localhost:3000/api/v1/status ...
[1] making HTTP(S) head request to  url:http://localhost:3000/api/v1/status ...
[1] making HTTP(S) head request to  url:http://localhost:3000/api/v1/status ...
[0]  Ã”Â£Ã´ Ready in 2.7s
[0]  Ã”Â£Ã´ Compiled /api/v1/status in 378ms (299 modules)
[1] making HTTP(S) head request to  url:http://localhost:3000/api/v1/status ...
[0]  HEAD /api/v1/status/ 200 in 1696ms
[0]  HEAD /api/v1/status/ 200 in 1698ms
[1]   HTTP(S) result for http://localhost:3000/api/v1/status: {
[1]   status: 200,
[1]   statusText: 'OK',
[1]   headers: Object [AxiosHeaders] {
[1]     'content-type': 'application/json; charset=utf-8',
[1]     etag: '"78f8prqsj23p"',
[1]     'content-length': '133',
[1]     vary: 'Accept-Encoding',
[1]     date: 'Mon, 15 Dec 2025 15:01:34 GMT',
[1]     connection: 'keep-alive',
[1]     'keep-alive': 'timeout=5'
[1]   },
[1]   data: ''
[1] }
[1] wait-on(29504) complete
[0]  HEAD /api/v1/status/ 200 in 171ms
[0]  HEAD /api/v1/status/ 200 in 1704ms
[1] Â­Æ’Ã¶Âº Carregado arquivo de ambiente: .env.test
[1] Â­Æ’Ã¶Ã¹ (Tentativa 1/20) Conectando (host=localhost port=5434 user=local_user)...
[1] Ã”Â£Ã  Conexâ”œÃºo administrativa estabelecida.
[1] Ã”Â£Ã  Banco de teste 'local_db_test' jâ”œÃ­ existe.
[1] Â­Æ’Ã¶Ã¤ Executando migraâ”œÂºâ”œÃes de teste...
[1] Â­Æ’Ã¶Âº Variâ”œÃ­veis carregadas de .env.test
[1] Executando migraâ”œÂºâ”œÃes automaticamente...
[1] NODE_ENV: test
[1] ENV file: .env.test
[1] Variâ”œÃ­veis de admin definidas: true
[1] Verificaâ”œÂºâ”œÃºo da coluna 'role' na tabela 'users' concluâ”œÂ¡da
[1] Admin user Danilo (danilo2311@gmail.com) created or updated successfully
[1] Migraâ”œÂºâ”œÃºo de roles concluâ”œÂ¡da: 'user' Ã”Ã¥Ã† 'terapeuta', adicionado 'secretaria'
[1] Migraâ”œÂºâ”œÃºo: Adicionada coluna last_email_sent na tabela invites
[1] Migraâ”œÂºâ”œÃºo de correâ”œÂºâ”œÃºo de timestamp - campos dt_nascimento e origem jâ”œÃ­ foram tornados opcionais anteriormente
[1] Migraâ”œÂºâ”œÃºo de correâ”œÂºâ”œÃºo de timestamp - coluna 'curriculo' jâ”œÃ­ foi removida anteriormente
[1] Migraâ”œÂºâ”œÃes pendentes encontradas: 26
[1] - 1735218270409_create-terapeutas
[1] - 1740143991070_create-users
[1] - 1741048796523_create-invites
[1] - 1741048800000_add-role-to-users
[1] - 1744376265471_create-pacientes
[1] - 1744549368040_create-agendamento
[1] - 1744549368049_create-sessoes
[1] - 1744648322521_add-valor-repasse-to-sessoes
[1] - 1746794771891_create-admin
[1] - 1746798677616_add-agendamento-id-to-sessoes
[1] - 1750434568631_create-transacoes
[1] - 1750441189723_create-user-sessions
[1] - 1750696179576_update-user-roles
[1] - 1750699950000_add-email-tracking-to-invites
[1] - 1750862182528_add-user-id-to-terapeutas
[1] - 1751282806741_add-sessao-realizada-to-agendamentos
[1] - 1751389870451_add-repasse-realizado-to-sessoes
[1] - 1751456684832_add-nota-fiscal-and-update-sessoes
[1] - 1751804247792_update-terapeutas-schema
[1] - 1751808400000_add-curriculo-arquivo-to-terapeutas
[1] - 1751890772373_add-falta-to-agendamento
[1] - 1751979228692_make-paciente-fields-optional
[1] - 1751979244388_remove-curriculo-from-terapeutas
[1] - 1752061264872_remove-remarcado-from-agendamento
[1] - 1752239236049_add-token-version-to-users
[1] - 1760433506791_add-sala-321-to-agendamentos
[1] Verificaâ”œÂºâ”œÃºo da coluna 'role' na tabela 'users' concluâ”œÂ¡da
[1] Admin user Danilo (danilo2311@gmail.com) created or updated successfully
[1] Migraâ”œÂºâ”œÃºo de roles concluâ”œÂ¡da: 'user' Ã”Ã¥Ã† 'terapeuta', adicionado 'secretaria'
[1] Migraâ”œÂºâ”œÃºo: Adicionada coluna last_email_sent na tabela invites
[1] Migraâ”œÂºâ”œÃºo de correâ”œÂºâ”œÃºo de timestamp - campos dt_nascimento e origem jâ”œÃ­ foram tornados opcionais anteriormente
[1] Migraâ”œÂºâ”œÃºo de correâ”œÂºâ”œÃºo de timestamp - coluna 'curriculo' jâ”œÃ­ foi removida anteriormente
[1] Migraâ”œÂºâ”œÃes executadas: 26
[1] Ã”Â£Ã´ 1735218270409_create-terapeutas
[1] Ã”Â£Ã´ 1740143991070_create-users
[1] Ã”Â£Ã´ 1741048796523_create-invites
[1] Ã”Â£Ã´ 1741048800000_add-role-to-users
[1] Ã”Â£Ã´ 1744376265471_create-pacientes
[1] Ã”Â£Ã´ 1744549368040_create-agendamento
[1] Ã”Â£Ã´ 1744549368049_create-sessoes
[1] Ã”Â£Ã´ 1744648322521_add-valor-repasse-to-sessoes
[1] Ã”Â£Ã´ 1746794771891_create-admin
[1] Ã”Â£Ã´ 1746798677616_add-agendamento-id-to-sessoes
[1] Ã”Â£Ã´ 1750434568631_create-transacoes
[1] Ã”Â£Ã´ 1750441189723_create-user-sessions
[1] Ã”Â£Ã´ 1750696179576_update-user-roles
[1] Ã”Â£Ã´ 1750699950000_add-email-tracking-to-invites
[1] Ã”Â£Ã´ 1750862182528_add-user-id-to-terapeutas
[1] Ã”Â£Ã´ 1751282806741_add-sessao-realizada-to-agendamentos
[1] Ã”Â£Ã´ 1751389870451_add-repasse-realizado-to-sessoes
[1] Ã”Â£Ã´ 1751456684832_add-nota-fiscal-and-update-sessoes
[1] Ã”Â£Ã´ 1751804247792_update-terapeutas-schema
[1] Ã”Â£Ã´ 1751808400000_add-curriculo-arquivo-to-terapeutas
[1] Ã”Â£Ã´ 1751890772373_add-falta-to-agendamento
[1] Ã”Â£Ã´ 1751979228692_make-paciente-fields-optional
[1] Ã”Â£Ã´ 1751979244388_remove-curriculo-from-terapeutas
[1] Ã”Â£Ã´ 1752061264872_remove-remarcado-from-agendamento
[1] Ã”Â£Ã´ 1752239236049_add-token-version-to-users
[1] Ã”Â£Ã´ 1760433506791_add-sala-321-to-agendamentos
[1] Migraâ”œÂºâ”œÃes concluâ”œÂ¡das com sucesso!
[1] Ã”Â£Ã  Migraâ”œÂºâ”œÃes executadas com sucesso!
[0]  GET /api/v1/status/ 200 in 94ms
[0]  GET /api/v1/status/ 200 in 95ms
[0]  GET /api/v1/status/ 200 in 90ms
[0]  GET /api/v1/status/ 200 in 91ms
[1] FAIL tests/integration/api/v1/users/secretaria-role.test.js
[1]   Role assignment: secretaria
[1]     â”œÃ¹ user created with secretaria invite has only role 'secretaria' (17 ms)
[1]     â”œÃ¹ user created with secretaria role can access secretaria routes (16 ms)
[1]     â”œÃ¹ secretaria pode visualizar e criar agendamentos para qualquer terapeuta (15 ms)
[1]     â”œÃ¹ secretaria pode visualizar e cadastrar pacientes para qualquer terapeuta (14 ms)
[1]     â”œÃ¹ secretaria pode visualizar e cadastrar terapeutas (16 ms)
[1]     â”œÃ¹ secretaria pode atualizar status de nota fiscal das sessâ”œÃes (15 ms)
[1]     â”œÃ¹ secretaria pode visualizar e registrar sessâ”œÃes (15 ms)
[1]     â”œÃ¹ secretaria nâ”œÃºo pode acessar ou enviar convites (16 ms)
[1]     â”œÃ¹ secretaria pode criar agendamentos com a nova Sala 321 (16 ms)
[1]     â”œÃ¹ nâ”œÃºo deve aceitar valores invâ”œÃ­lidos para localAgendamento (16 ms)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ user created with secretaria invite has only role 'secretaria'
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:32:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:32:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ user created with secretaria role can access secretaria routes
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:73:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:73:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode visualizar e criar agendamentos para qualquer terapeuta
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:130:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:130:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode visualizar e cadastrar pacientes para qualquer terapeuta
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:243:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:243:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode visualizar e cadastrar terapeutas
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:345:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:345:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode atualizar status de nota fiscal das sessâ”œÃes
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:441:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:441:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode visualizar e registrar sessâ”œÃes
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:529:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:529:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria nâ”œÃºo pode acessar ou enviar convites
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:638:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:638:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode criar agendamentos com a nova Sala 321
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:721:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:721:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ nâ”œÃºo deve aceitar valores invâ”œÃ­lidos para localAgendamento
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:839:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:839:20)
[1] 
[0]  GET /api/v1/status/ 200 in 98ms
[1] FAIL tests/integration/api/v1/admin/users/put.test.js
[1]   PUT /api/v1/admin/users/[userId]
[1]     â”œÃ¹ Deve atualizar o usuâ”œÃ­rio quando solicitado por um administrador (102 ms)
[1]     â”œÃ¹ Deve atualizar a senha quando solicitado por um administrador (94 ms)
[1]     â”œÃ¹ Deve rejeitar atualizaâ”œÂºâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo â”œÂ® um administrador (84 ms)
[1]     â”œÃ¹ Deve rejeitar atualizaâ”œÂºâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo existe (85 ms)
[1]     â”œÃ¹ Deve rejeitar senha muito curta (89 ms)
[1]     â”œÃ¹ Deve rejeitar requisiâ”œÂºâ”œÃºo sem dados para atualizar (80 ms)
[1] 
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve atualizar o usuâ”œÃ­rio quando solicitado por um administrador
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:55:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:55:23)
[1] 
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve atualizar a senha quando solicitado por um administrador
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:113:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:113:23)
[1] 
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar atualizaâ”œÂºâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo â”œÂ® um administrador
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:162:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:162:23)
[1] 
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar atualizaâ”œÂºâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo existe
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:216:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:216:23)
[1] 
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar senha muito curta
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:254:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:254:23)
[1] 
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar requisiâ”œÂºâ”œÃºo sem dados para atualizar
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:299:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:299:23)
[1] 
[0]  GET /api/v1/status/ 200 in 95ms
[0]  GET /api/v1/status/ 200 in 94ms
[0]  GET /api/v1/status/ 200 in 90ms
[0]  Ã”Â£Ã´ Compiled /api/v1/users in 103ms (309 modules)
[0]  POST /api/v1/users/ 400 in 240ms
[1] FAIL tests/integration/api/v1/users/post.test.js
[1]   POST /api/v1/users
[1]     â”œÃ¹ Creating user with valid invite code (14 ms)
[1]     â”œÃ¹ Creating user with different role with invite code (16 ms)
[1]     Ã”ÃªÃœ With invalid invite code (248 ms)
[1]     â”œÃ¹ With duplicated email (28 ms)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/users Ã”Ã‡â•‘ Creating user with valid invite code
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:34:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:34:20)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/users Ã”Ã‡â•‘ Creating user with different role with invite code
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:76:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:76:20)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/users Ã”Ã‡â•‘ With duplicated email
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:126:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:126:20)
[1] 
[0]  GET /api/v1/status/ 200 in 107ms
[0]  GET /api/v1/status/ 200 in 87ms
[0]  GET /api/v1/status/ 200 in 88ms
[1] FAIL tests/integration/api/v1/users/[username]/get.test.js
[1]   GET /api/v1/users/[username]
[1]     Logged User
[1]       â”œÃ¹ Authentication setup is successful
[1]       â”œÃ¹ With exact case match (1 ms)
[1]       â”œÃ¹ With case mismatch
[1]       â”œÃ¹ With username not found
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/users/[username] Ã”Ã‡â•‘ Logged User Ã”Ã‡â•‘ Authentication setup is successful
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/users/[username] Ã”Ã‡â•‘ Logged User Ã”Ã‡â•‘ With exact case match
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/users/[username] Ã”Ã‡â•‘ Logged User Ã”Ã‡â•‘ With case mismatch
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/users/[username] Ã”Ã‡â•‘ Logged User Ã”Ã‡â•‘ With username not found
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[0]  GET /api/v1/status/ 200 in 93ms
[0]  Ã”Â£Ã´ Compiled /api/v1/dashboard/financeiro-otimizado in 91ms (315 modules)
[0]  GET /api/v1/dashboard/financeiro-otimizado/ 401 in 138ms
[1] FAIL tests/integration/api/v1/financeiro/get.test.js
[1]   GET /api/v1/dashboard/financeiro-otimizado
[1]     â”œÃ¹ usuâ”œÃ­rio admin deve conseguir acessar os dados financeiros (15 ms)
[1]     Ã”ÃªÃœ usuâ”œÃ­rio nâ”œÃºo autenticado deve receber 401 (142 ms)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/dashboard/financeiro-otimizado Ã”Ã‡â•‘ usuâ”œÃ­rio admin deve conseguir acessar os dados financeiros
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createAndLoginAdmin (tests/integration/api/v1/financeiro/get.test.js:12:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/financeiro/get.test.js:57:19)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createAndLoginAdmin (tests/integration/api/v1/financeiro/get.test.js:12:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/financeiro/get.test.js:57:19)
[1] 
[0]  GET /api/v1/status/ 200 in 96ms
[0]  GET /api/v1/status/ 200 in 91ms
[1] FAIL tests/integration/api/v1/terapeutas/post.test.js
[1]   POST /api/v1/terapeutas
[1]     Usuâ”œÃ­rio autenticado
[1]       â”œÃ¹ Authentication setup is successful (1 ms)
[1]       â”œÃ¹ Com token vâ”œÃ­lido e dados completos
[1]       â”œÃ¹ Com email duplicado
[1]     Usuâ”œÃ­rio nâ”œÃºo autenticado
[1]       â”œÃ¹ Tentativa sem autenticaâ”œÂºâ”œÃºo
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio autenticado Ã”Ã‡â•‘ Authentication setup is successful
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio autenticado Ã”Ã‡â•‘ Com token vâ”œÃ­lido e dados completos
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio autenticado Ã”Ã‡â•‘ Com email duplicado
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio nâ”œÃºo autenticado Ã”Ã‡â•‘ Tentativa sem autenticaâ”œÂºâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[0]  GET /api/v1/status/ 200 in 92ms
[1] FAIL tests/integration/api/v1/auth/login.test.js
[1]   POST /api/v1/auth/login
[1]     â”œÃ¹ deve autenticar com credenciais vâ”œÃ­lidas e criar uma sessâ”œÃºo (32 ms)
[1]     â”œÃ¹ nâ”œÃºo deve autenticar com senha incorreta (33 ms)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/auth/login Ã”Ã‡â•‘ deve autenticar com credenciais vâ”œÃ­lidas e criar uma sessâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/auth/login.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/login.test.js:57:18)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/auth/login.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/login.test.js:57:18)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/auth/login Ã”Ã‡â•‘ nâ”œÃºo deve autenticar com senha incorreta
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/auth/login.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/login.test.js:87:5)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/auth/login.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/login.test.js:87:5)
[1] 
[0]  GET /api/v1/status/ 200 in 88ms
[1] FAIL tests/integration/api/v1/sessions/get.test.js
[1]   GET /api/v1/admin/sessions
[1]     â”œÃ¹ Deve retornar erro 401 para usuâ”œÃ­rio nâ”œÃºo autenticado
[1]     â”œÃ¹ Deve retornar erro 401 para token invâ”œÃ­lido
[1]     â”œÃ¹ Deve permitir acesso para usuâ”œÃ­rio admin e listar sessâ”œÃes
[1]   POST /api/v1/admin/sessions
[1]     â”œÃ¹ Deve retornar erro 400 quando userId nâ”œÃºo â”œÂ® fornecido
[1]     â”œÃ¹ Deve retornar erro 401 para usuâ”œÃ­rio nâ”œÃºo autenticado tentando forâ”œÂºar logout
[1]     â”œÃ¹ Deve retornar erro 401 para token invâ”œÃ­lido tentando forâ”œÂºar logout (1 ms)
[1]     â”œÃ¹ Deve funcionar corretamente o controle de sessâ”œÃes do admin
[1]     â”œÃ¹ Deve forâ”œÂºar a revalidaâ”œÂºâ”œÃºo do token se a sessâ”œÃºo nâ”œÃºo existir no banco de dados
[1]     â”œÃ¹ Deve manter apenas uma sessâ”œÃºo ativa por usuâ”œÃ­rio
[1]     â”œÃ¹ Deve demonstrar o comportamento do sistema de interceptaâ”œÂºâ”œÃºo de sessâ”œÃºo
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/admin/sessions Ã”Ã‡â•‘ Deve retornar erro 401 para usuâ”œÃ­rio nâ”œÃºo autenticado
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/admin/sessions Ã”Ã‡â•‘ Deve retornar erro 401 para token invâ”œÃ­lido
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/admin/sessions Ã”Ã‡â•‘ Deve permitir acesso para usuâ”œÃ­rio admin e listar sessâ”œÃes
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve retornar erro 400 quando userId nâ”œÃºo â”œÂ® fornecido
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve retornar erro 401 para usuâ”œÃ­rio nâ”œÃºo autenticado tentando forâ”œÂºar logout
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve retornar erro 401 para token invâ”œÃ­lido tentando forâ”œÂºar logout
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve funcionar corretamente o controle de sessâ”œÃes do admin
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve forâ”œÂºar a revalidaâ”œÂºâ”œÃºo do token se a sessâ”œÃºo nâ”œÃºo existir no banco de dados
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve manter apenas uma sessâ”œÃºo ativa por usuâ”œÃ­rio
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve demonstrar o comportamento do sistema de interceptaâ”œÂºâ”œÃºo de sessâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[0]  GET /api/v1/status/ 200 in 88ms
[1] FAIL tests/integration/api/v1/admin/users/delete.test.js
[1]   DELETE /api/v1/admin/users/[userId]
[1]     â”œÃ¹ Deve excluir o usuâ”œÃ­rio quando solicitado por um administrador
[1]     â”œÃ¹ Deve excluir mâ”œâ•‘ltiplos usuâ”œÃ­rios em sequâ”œÂ¬ncia
[1]     â”œÃ¹ Deve rejeitar exclusâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo â”œÂ® um administrador
[1]     â”œÃ¹ Deve rejeitar exclusâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo existe
[1]     â”œÃ¹ Deve impedir que um administrador exclua sua prâ”œâ”‚pria conta
[1]     â”œÃ¹ Deve validar o token de autenticaâ”œÂºâ”œÃºo
[1]     â”œÃ¹ Deve rejeitar token invâ”œÃ­lido
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve excluir o usuâ”œÃ­rio quando solicitado por um administrador
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve excluir mâ”œâ•‘ltiplos usuâ”œÃ­rios em sequâ”œÂ¬ncia
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar exclusâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo â”œÂ® um administrador
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar exclusâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo existe
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve impedir que um administrador exclua sua prâ”œâ”‚pria conta
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve validar o token de autenticaâ”œÂºâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar token invâ”œÃ­lido
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[0]  GET /api/v1/status/ 200 in 94ms
[1] FAIL tests/integration/api/v1/auth/logout.test.js
[1]   POST /api/v1/auth/logout
[1]     â”œÃ¹ deve fazer logout e invalidar a sessâ”œÃºo (42 ms)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/auth/logout Ã”Ã‡â•‘ deve fazer logout e invalidar a sessâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createAndLoginUser (tests/integration/api/v1/auth/logout.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/logout.test.js:62:29)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createAndLoginUser (tests/integration/api/v1/auth/logout.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/logout.test.js:62:29)
[1] 
[0]  GET /api/v1/status/ 200 in 94ms
[1] FAIL tests/integration/api/v1/terapeutas/get.test.js
[1]   GET /api/v1/terapeutas
[1]     Usuâ”œÃ­rio autenticado
[1]       â”œÃ¹ Recuperando terapeutas com autenticaâ”œÂºâ”œÃºo
[1]     Usuâ”œÃ­rio nâ”œÃºo autenticado
[1]       â”œÃ¹ Tentativa sem autenticaâ”œÂºâ”œÃºo
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio autenticado Ã”Ã‡â•‘ Recuperando terapeutas com autenticaâ”œÂºâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/get.test.js:18:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/get.test.js:18:3)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio nâ”œÃºo autenticado Ã”Ã‡â•‘ Tentativa sem autenticaâ”œÂºâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/get.test.js:18:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/get.test.js:18:3)
[1] 
[1] PASS tests/frontend/pages/dashboard/terapeutas/create.test.js
[1]   Criar Novo Terapeuta
[1]     Ã”ÃªÃœ Deve abrir o modal e criar um novo terapeuta com sucesso (1580 ms)
[1] 
[1] PASS tests/frontend/pages/dashboard/terapeutas/edit.test.js
[1]   Editar Terapeuta
[1]     Ã”ÃªÃœ Deve editar um terapeuta com sucesso (838 ms)
[1] 
[0]  GET /api/v1/status/ 200 in 94ms
[0]  Ã”Â£Ã´ Compiled /api/v1/migrations in 61ms (322 modules)
[0] Verificaâ”œÂºâ”œÃºo da coluna 'role' na tabela 'users' concluâ”œÂ¡da
[0] Admin user Danilo (danilo2311@gmail.com) created or updated successfully
[0] Migraâ”œÂºâ”œÃºo de roles concluâ”œÂ¡da: 'user' Ã”Ã¥Ã† 'terapeuta', adicionado 'secretaria'
[0] Migraâ”œÂºâ”œÃºo: Adicionada coluna last_email_sent na tabela invites
[0] Migraâ”œÂºâ”œÃºo de correâ”œÂºâ”œÃºo de timestamp - campos dt_nascimento e origem jâ”œÃ­ foram tornados opcionais anteriormente
[0] Migraâ”œÂºâ”œÃºo de correâ”œÂºâ”œÃºo de timestamp - coluna 'curriculo' jâ”œÃ­ foi removida anteriormente
[0]  POST /api/v1/migrations/ 201 in 593ms
[0]  POST /api/v1/migrations/ 200 in 36ms
[1] PASS tests/integration/api/v1/migrations/post.test.js
[1]   POST /api/v1/migrations
[1]     Anonymous user
[1]       Running pending migrations
[1]         Ã”ÃªÃœ For the first time (600 ms)
[1]         Ã”ÃªÃœ For the second time (41 ms)
[1] 
[1] PASS tests/frontend/pages/dashboard/terapeutas/delete.test.js
[1]   Excluir Terapeuta
[1]     Ã”ÃªÃœ Deve abrir o modal de confirmaâ”œÂºâ”œÃºo e excluir o terapeuta com sucesso (267 ms)
[1] 
[1] PASS tests/frontend/pages/dashboard/terapeutas/get.test.js
[1]   Dashboard Terapeutas
[1]     Ã”ÃªÃœ Pâ”œÃ­gina deve ser carregada corretamente (100 ms)
[1]     Ã”ÃªÃœ Banco de dados deve estar ativo (1 ms)
[1]     Ã”ÃªÃœ Tabela de terapeutas deve estar pronta para aceitar novos registros (51 ms)
[1] 
[1] PASS tests/frontend/pages/dashboard/convites/convites.test.js
[1]   Sistema de Convites
[1]     Ã”ÃªÃœ Administrador pode acessar a pâ”œÃ­gina de convites (206 ms)
[1]     Ã”ÃªÃœ Simular criaâ”œÂºâ”œÃºo de novo convite como administrador (1 ms)
[1] 
[0]  GET /api/v1/status/ 200 in 98ms
[0]  GET /api/v1/status/ 200 in 88ms
[0]  GET /api/v1/status/ 200 in 92ms
[0]  GET /api/v1/users/ 405 in 16ms
[1] PASS tests/integration/api/v1/users/get.test.js
[1]   GET /api/v1/users
[1]     Anonymous user
[1]       Ã”ÃªÃœ With no data (23 ms)
[1] 
[0]  GET /api/v1/status/ 200 in 87ms
[0]  Ã”Â£Ã´ Compiled /api/v1/transacoes in 88ms (325 modules)
[0]  GET /api/v1/transacoes/ 401 in 137ms
[1] PASS tests/integration/api/v1/transacoes/get.test.js
[1]   GET /api/v1/transacoes
[1]     Anonymous user
[1]       Ã”ÃªÃœ With no data (165 ms)
[1] 
[0]  GET /api/v1/status/ 200 in 93ms
[0] Verificaâ”œÂºâ”œÃºo da coluna 'role' na tabela 'users' concluâ”œÂ¡da
[0] Admin user Danilo (danilo2311@gmail.com) created or updated successfully
[0] Migraâ”œÂºâ”œÃºo de roles concluâ”œÂ¡da: 'user' Ã”Ã¥Ã† 'terapeuta', adicionado 'secretaria'
[0] Migraâ”œÂºâ”œÃºo: Adicionada coluna last_email_sent na tabela invites
[0] Migraâ”œÂºâ”œÃºo de correâ”œÂºâ”œÃºo de timestamp - campos dt_nascimento e origem jâ”œÃ­ foram tornados opcionais anteriormente
[0] Migraâ”œÂºâ”œÃºo de correâ”œÂºâ”œÃºo de timestamp - coluna 'curriculo' jâ”œÃ­ foi removida anteriormente
[0]  GET /api/v1/migrations/ 200 in 114ms
[1] PASS tests/integration/api/v1/migrations/get.test.js
[1]   GET /api/v1/migrations
[1]     Anonymous user
[1]       Ã”ÃªÃœ Retrieving pending migrations (120 ms)
[1] 
[0]  GET /api/v1/status/ 200 in 93ms
[0]  GET /api/v1/status/ 200 in 91ms
[1] PASS tests/integration/api/v1/status/get.test.js
[1]   GET /api/v1/status
[1]     Anonymous user
[1]       Ã”ÃªÃœ Retrieving current system status (97 ms)
[1] 
[0]  GET /api/v1/status/ 200 in 90ms
[0]  POST /api/v1/status/ 405 in 4ms
[1] PASS tests/integration/api/v1/status/post.test.js
[1]   POST /api/v1/status
[1]     Anonymous user
[1]       Ã”ÃªÃœ Retrieving current system status (9 ms)
[1] 
[1] PASS tests/frontend/hooks/useAuth.test.js
[1]   useAuth hook
[1]     Ã”ÃªÃœ deve inicializar com usuâ”œÃ­rio null e loading false (3 ms)
[1]     Ã”ÃªÃœ deve carregar usuâ”œÃ­rio do localStorage na inicializaâ”œÂºâ”œÃºo (1 ms)
[1]     Ã”ÃªÃœ deve identificar corretamente um administrador (2 ms)
[1]     Ã”ÃªÃœ deve fazer login com sucesso (8 ms)
[1]     Ã”ÃªÃœ deve lidar com erro de login (1 ms)
[1]     Ã”ÃªÃœ deve fazer logout corretamente (2 ms)
[1]     Ã”ÃªÃœ deve lidar com erro no JSON ao carregar usuâ”œÃ­rio do localStorage (1 ms)
[1]     Ã”ÃªÃœ deve lidar com erro de rede durante login (1 ms)
[1] 
[1] PASS tests/utils/authenticatedFetch.test.js
[1]   authenticatedFetch utils
[1]     authenticatedFetch
[1]       Ã”ÃªÃœ deve adicionar token de autenticaâ”œÂºâ”œÃºo automaticamente (1 ms)
[1]       Ã”ÃªÃœ deve interceptar erro 401 e forâ”œÂºar logout (5 ms)
[1]       Ã”ÃªÃœ deve pular verificaâ”œÂºâ”œÃºo de auth quando skipAuthCheck â”œÂ® true
[1]       Ã”ÃªÃœ deve mesclar headers personalizados com Authorization
[1]       Ã”ÃªÃœ deve funcionar sem token quando skipAuthCheck â”œÂ® true (1 ms)
[1]       Ã”ÃªÃœ deve interceptar diferentes tipos de erro 401 (59 ms)
[1]       Ã”ÃªÃœ deve interceptar erro 401 mesmo quando nâ”œÃºo consegue ler response (15 ms)
[1]     forceLogout
[1]       Ã”ÃªÃœ deve limpar localStorage e redirecionar para login
[1]       Ã”ÃªÃœ deve usar mensagem padrâ”œÃºo quando nâ”œÃºo fornecida
[1] 
[1] Summary of all failing tests
[1] FAIL tests/integration/api/v1/users/secretaria-role.test.js
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ user created with secretaria invite has only role 'secretaria'
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:32:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:32:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ user created with secretaria role can access secretaria routes
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:73:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:73:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode visualizar e criar agendamentos para qualquer terapeuta
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:130:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:130:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode visualizar e cadastrar pacientes para qualquer terapeuta
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:243:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:243:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode visualizar e cadastrar terapeutas
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:345:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:345:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode atualizar status de nota fiscal das sessâ”œÃes
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:441:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:441:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode visualizar e registrar sessâ”œÃes
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:529:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:529:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria nâ”œÃºo pode acessar ou enviar convites
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:638:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:638:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ secretaria pode criar agendamentos com a nova Sala 321
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:721:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:721:20)
[1] 
[1]   Ã”Ã¹Ã… Role assignment: secretaria Ã”Ã‡â•‘ nâ”œÃºo deve aceitar valores invâ”œÃ­lidos para localAgendamento
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:839:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/secretaria-role.test.js:839:20)
[1] 
[1] FAIL tests/integration/api/v1/admin/users/put.test.js
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve atualizar o usuâ”œÃ­rio quando solicitado por um administrador
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:55:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:55:23)
[1] 
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve atualizar a senha quando solicitado por um administrador
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:113:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:113:23)
[1] 
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar atualizaâ”œÂºâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo â”œÂ® um administrador
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:162:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:162:23)
[1] 
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar atualizaâ”œÂºâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo existe
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:216:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:216:23)
[1] 
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar senha muito curta
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:254:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:254:23)
[1] 
[1]   Ã”Ã¹Ã… PUT /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar requisiâ”œÂºâ”œÃºo sem dados para atualizar
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:299:23)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/admin/users/put.test.js:12:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/put.test.js:299:23)
[1] 
[1] FAIL tests/integration/api/v1/users/post.test.js
[1]   Ã”Ã¹Ã… POST /api/v1/users Ã”Ã‡â•‘ Creating user with valid invite code
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:34:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:34:20)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/users Ã”Ã‡â•‘ Creating user with different role with invite code
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:76:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:76:20)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/users Ã”Ã‡â•‘ With duplicated email
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:126:20)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createInvite (tests/helpers/auth.js:42:18)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/post.test.js:126:20)
[1] 
[1] FAIL tests/integration/api/v1/users/[username]/get.test.js
[1]   Ã”Ã¹Ã… GET /api/v1/users/[username] Ã”Ã‡â•‘ Logged User Ã”Ã‡â•‘ Authentication setup is successful
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/users/[username] Ã”Ã‡â•‘ Logged User Ã”Ã‡â•‘ With exact case match
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/users/[username] Ã”Ã‡â•‘ Logged User Ã”Ã‡â•‘ With case mismatch
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/users/[username] Ã”Ã‡â•‘ Logged User Ã”Ã‡â•‘ With username not found
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/users/[username]/get.test.js:30:5)
[1] 
[1] FAIL tests/integration/api/v1/financeiro/get.test.js
[1]   Ã”Ã¹Ã… GET /api/v1/dashboard/financeiro-otimizado Ã”Ã‡â•‘ usuâ”œÃ­rio admin deve conseguir acessar os dados financeiros
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createAndLoginAdmin (tests/integration/api/v1/financeiro/get.test.js:12:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/financeiro/get.test.js:57:19)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createAndLoginAdmin (tests/integration/api/v1/financeiro/get.test.js:12:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/financeiro/get.test.js:57:19)
[1] 
[1] FAIL tests/integration/api/v1/terapeutas/post.test.js
[1]   Ã”Ã¹Ã… POST /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio autenticado Ã”Ã‡â•‘ Authentication setup is successful
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio autenticado Ã”Ã‡â•‘ Com token vâ”œÃ­lido e dados completos
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio autenticado Ã”Ã‡â•‘ Com email duplicado
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio nâ”œÃºo autenticado Ã”Ã‡â•‘ Tentativa sem autenticaâ”œÂºâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/post.test.js:27:5)
[1] 
[1] FAIL tests/integration/api/v1/auth/login.test.js
[1]   Ã”Ã¹Ã… POST /api/v1/auth/login Ã”Ã‡â•‘ deve autenticar com credenciais vâ”œÃ­lidas e criar uma sessâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/auth/login.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/login.test.js:57:18)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/auth/login.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/login.test.js:57:18)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/auth/login Ã”Ã‡â•‘ nâ”œÃºo deve autenticar com senha incorreta
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createTestUser (tests/integration/api/v1/auth/login.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/login.test.js:87:5)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createTestUser (tests/integration/api/v1/auth/login.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/login.test.js:87:5)
[1] 
[1] FAIL tests/integration/api/v1/sessions/get.test.js
[1]   Ã”Ã¹Ã… GET /api/v1/admin/sessions Ã”Ã‡â•‘ Deve retornar erro 401 para usuâ”œÃ­rio nâ”œÃºo autenticado
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/admin/sessions Ã”Ã‡â•‘ Deve retornar erro 401 para token invâ”œÃ­lido
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/admin/sessions Ã”Ã‡â•‘ Deve permitir acesso para usuâ”œÃ­rio admin e listar sessâ”œÃes
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve retornar erro 400 quando userId nâ”œÃºo â”œÂ® fornecido
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve retornar erro 401 para usuâ”œÃ­rio nâ”œÃºo autenticado tentando forâ”œÂºar logout
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve retornar erro 401 para token invâ”œÃ­lido tentando forâ”œÂºar logout
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve funcionar corretamente o controle de sessâ”œÃes do admin
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve forâ”œÂºar a revalidaâ”œÂºâ”œÃºo do token se a sessâ”œÃºo nâ”œÃºo existir no banco de dados
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve manter apenas uma sessâ”œÃºo ativa por usuâ”œÃ­rio
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]   Ã”Ã¹Ã… POST /api/v1/admin/sessions Ã”Ã‡â•‘ Deve demonstrar o comportamento do sistema de interceptaâ”œÂºâ”œÃºo de sessâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/sessions/get.test.js:13:3)
[1] 
[1] FAIL tests/integration/api/v1/admin/users/delete.test.js
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve excluir o usuâ”œÃ­rio quando solicitado por um administrador
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve excluir mâ”œâ•‘ltiplos usuâ”œÃ­rios em sequâ”œÂ¬ncia
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar exclusâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo â”œÂ® um administrador
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar exclusâ”œÃºo quando o usuâ”œÃ­rio nâ”œÃºo existe
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve impedir que um administrador exclua sua prâ”œâ”‚pria conta
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve validar o token de autenticaâ”œÂºâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]   Ã”Ã¹Ã… DELETE /api/v1/admin/users/[userId] Ã”Ã‡â•‘ Deve rejeitar token invâ”œÃ­lido
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/admin/users/delete.test.js:51:3)
[1] 
[1] FAIL tests/integration/api/v1/auth/logout.test.js
[1]   Ã”Ã¹Ã… POST /api/v1/auth/logout Ã”Ã‡â•‘ deve fazer logout e invalidar a sessâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at createAndLoginUser (tests/integration/api/v1/auth/logout.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/logout.test.js:62:29)
[1] 
[1]     Cause:
[1]     error: relation "invites" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at createAndLoginUser (tests/integration/api/v1/auth/logout.test.js:13:3)
[1]       at Object.<anonymous> (tests/integration/api/v1/auth/logout.test.js:62:29)
[1] 
[1] FAIL tests/integration/api/v1/terapeutas/get.test.js
[1]   Ã”Ã¹Ã… GET /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio autenticado Ã”Ã‡â•‘ Recuperando terapeutas com autenticaâ”œÂºâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/get.test.js:18:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/get.test.js:18:3)
[1] 
[1]   Ã”Ã¹Ã… GET /api/v1/terapeutas Ã”Ã‡â•‘ Usuâ”œÃ­rio nâ”œÃºo autenticado Ã”Ã‡â•‘ Tentativa sem autenticaâ”œÂºâ”œÃºo
[1] 
[1]     ServiceError: Erro na conexâ”œÃºo com o Banco ou na Query.
[1] 
[1]     [0m [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]     [31m[1m>[22m[39m[90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({
[1]      [90m    |[39m                                [31m[1m^[22m[39m
[1]      [90m 12 |[39m       message[33m:[39m [32m"Erro na conexâ”œÃºo com o Banco ou na Query."[39m[33m,[39m
[1]      [90m 13 |[39m       cause[33m:[39m error[33m,[39m
[1]      [90m 14 |[39m     })[33m;[39m[0m
[1] 
[1]       at Object.query (infra/database.js:11:32)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/get.test.js:18:3)
[1] 
[1]     Cause:
[1]     error: relation "users" does not exist
[1] 
[1]     [0m [90m  6 |[39m   [36mtry[39m {
[1]      [90m  7 |[39m     client [33m=[39m [36mawait[39m getNewClient()[33m;[39m
[1]     [31m[1m>[22m[39m[90m  8 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m client[33m.[39mquery(queryObject)[33m;[39m
[1]      [90m    |[39m                    [31m[1m^[22m[39m
[1]      [90m  9 |[39m     [36mreturn[39m result[33m;[39m
[1]      [90m 10 |[39m   } [36mcatch[39m (error) {
[1]      [90m 11 |[39m     [36mconst[39m serviceErrorObject [33m=[39m [36mnew[39m [33mServiceError[39m({[0m
[1] 
[1]       at node_modules/pg/lib/client.js:535:17
[1]       at Object.query (infra/database.js:8:20)
[1]       at ensureDevAdminExists (tests/helpers/auth.js:12:25)
[1]       at Object.<anonymous> (tests/integration/api/v1/terapeutas/get.test.js:18:3)
[1] 
[1] 
[1] Test Suites: 11 failed, 13 passed, 24 total
[1] Tests:       50 failed, 34 passed, 84 total
[1] Snapshots:   0 total
[1] Time:        17.484 s
[1] Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
[1] wait-on -t 30000 -i 1000 -v http://localhost:3000/api/v1/status && jest --runInBand --verbose --forceExit exited with code 1
--> Sending SIGTERM to other processes..
[0] next dev exited with code 1
